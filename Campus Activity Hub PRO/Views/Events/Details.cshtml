@model Campus_Activity_Hub_PRO.Models.Event

@{
    ViewData["Title"] = Model.Title;
}

<div class="row mt-4">

    <div class="col-md-5">
        <img src="@Model.PosterPath"
             class="img-fluid rounded shadow"
             alt="Event poster" />
    </div>

    <div class="col-md-7">
        <h2>@Model.Title</h2>

        <p><strong>Category:</strong> @Model.Category?.Name</p>
        <p><strong>Date:</strong> @Model.EventDate.ToString("dd.MM.yyyy HH:mm")</p>
        <p><strong>Organizer:</strong> @Model.Organizer?.Name</p>
        <p><strong>Capacity:</strong> @Model.Capacity</p>

        @if (User.IsInRole("Student"))
        {
            <button id="registerBtn"
                    class="btn btn-primary mt-3"
                    data-event-id="@Model.Id">
                Register
            </button>

            <div id="registerResult" class="mt-3"></div>
        }
    </div>

</div>

@section Scripts {
    <script>
        document.getElementById("registerBtn")?.addEventListener("click", function () {

            const eventId = this.dataset.eventId;

            fetch('/Registrations/RegisterAjax', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(eventId)
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById("registerResult");

                if (data.success) {
                    resultDiv.innerHTML =
                        `<div class="alert alert-success">
                            You have successfully registered for the event.
                        </div>`;
                    document.getElementById("registerBtn").disabled = true;
                } else {
                    resultDiv.innerHTML =
                        `<div class="alert alert-danger">
                            ${data.message}
                        </div>`;
                }
            })
            .catch(() => {
                document.getElementById("registerResult").innerHTML =
                    `<div class="alert alert-danger">
                        Error while sending request.
                    </div>`;
            });
        });
    </script>
}
